<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Defender - Simulasi Sidang</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: {
                        bg: { main: '#030304', panel: '#0F1014' },
                        accent: { red: '#FF2A2A', darkRed: '#990000', green: '#10B981', yellow: '#F59E0B' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { 'float': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } } }
                }
            }
        }
    </script>

    <style>
        body { background: #030304; color: white; overflow: hidden; }
        [x-cloak] { display: none !important; }
        
        /* Glass Panel */
        .glass-panel {
            background: rgba(18, 18, 22, 0.65);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 40px 100px -12px rgba(0, 0, 0, 0.9);
        }

        /* Ambient Background */
        .orb { position: absolute; border-radius: 50%; filter: blur(150px); opacity: 0.3; z-index: 0; }
        .orb-1 { top: -20%; left: -20%; width: 70vw; height: 70vw; background: #FF2A2A; animation: float 10s infinite alternate; }
        .orb-2 { bottom: -20%; right: -20%; width: 60vw; height: 60vw; background: #4F46E5; animation: float 15s infinite alternate-reverse; }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #FF2A2A; }

        /* --- AVATAR CSS (CUSTOM USER) --- */
        .avatar {
            width: 120px; /* Sedikit diperkecil biar pas di layout */
            height: 120px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        /* Avatar Killer */
        .avatar.killer {
            background: #ffb27c;
            border: 4px solid #a30000;
            animation: shake 0.2s infinite linear;
            filter: hue-rotate(-10deg) saturate(1.3);
        }
        .killer .face { position: relative; }
        .killer .eye {
            width: 16px; height: 16px; background: black; border-radius: 50%; display: inline-block;
            animation: blinkFast 0.2s infinite; /* Mata kedip cepat banget pas marah */
        }
        .killer .eye.left { margin-right: 20px; }
        .killer .mouth {
            width: 36px; height: 10px; background: black; border-radius: 10px;
            transform: rotate(180deg); margin: 16px auto 0 auto;
        }

        /* Avatar Baik */
        .avatar.good {
            width: 120px; height: 120px; background: #ffd9a8;
            border-radius: 50%; border: 4px solid #5f5f5f;
            display: flex; justify-content: center; align-items: center;
            animation: floatAvatar 3s infinite ease-in-out;
        }
        .good .face { position: relative; }
        .good .eye {
            width: 14px; height: 14px; background: black; border-radius: 50%; display: inline-block;
            animation: blinkNormal 4s infinite;
        }
        .good .eye.left { margin-right: 20px; }
        .good .mouth.smile {
            width: 40px; height: 20px; border: 4px solid black; border-top: none;
            border-radius: 0 0 50px 50px; margin: 12px auto 0 auto;
        }

        /* Animations */
        @keyframes shake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2px, -2px) rotate(-2deg); }
            50% { transform: translate(-2px, 2px) rotate(2deg); }
            75% { transform: translate(2px, 2px) rotate(-1deg); }
        }
        @keyframes blinkFast { 0%, 10%, 100% { transform: scaleY(1); } 5% { transform: scaleY(0.1); } }
        @keyframes blinkNormal { 0%, 98%, 100% { transform: scaleY(1); } 99% { transform: scaleY(0.1); } }
        @keyframes floatAvatar { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Chat Bubbles */
        .chat-ai { background: rgba(30, 32, 40, 0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px 24px 24px 24px; color: #E2E8F0; }
        .chat-user { background: linear-gradient(135deg, #FF2A2A, #990000); border-radius: 24px 4px 24px 24px; color: white; box-shadow: 0 8px 25px rgba(255, 42, 42, 0.25); }
        .bubble { max-width: 80%; padding: 1.25rem 1.5rem; font-size: 0.95rem; line-height: 1.6; position: relative; }

        /* TOAST NOTIFICATION */
        #toast-container { position: fixed; top: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 12px; pointer-events: none; }
        .toast {
            pointer-events: auto; min-width: 300px; padding: 16px; border-radius: 16px; 
            background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); 
            color: white; box-shadow: 0 20px 40px rgba(0,0,0,0.6); 
            transform: translateX(120%); transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex; align-items: center; gap: 12px; font-size: 0.9rem; font-weight: 600;
        }
        .toast.show { transform: translateX(0); }
        .toast-error { border-left: 4px solid #FF2A2A; } .toast-error i { color: #FF2A2A; }
        .toast-success { border-left: 4px solid #10B981; } .toast-success i { color: #10B981; }
        .toast-info { border-left: 4px solid #3B82F6; } .toast-info i { color: #3B82F6; }
    </style>
</head>

<body x-data="defenseApp()" class="h-screen w-screen flex flex-col relative font-sans overflow-hidden">

    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none z-0"></div>

    <div id="toast-container"></div>

    <nav class="absolute top-0 w-full h-20 flex items-center justify-between px-8 z-50 transition-opacity duration-500" 
         :class="sessionActive ? 'opacity-0 pointer-events-none' : 'opacity-100'">
        <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.href='/'">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-accent-red to-black flex items-center justify-center border border-white/10 shadow-lg group-hover:scale-105 transition-transform">
                <i data-lucide="shield-alert" class="text-white w-5 h-5"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-white tracking-wide">The Defender</h1>
                <p class="text-[10px] text-gray-500 uppercase tracking-widest">Simulasi Sidang v4.0</p>
            </div>
        </div>
        <button onclick="window.location.href='/'" class="px-5 py-2.5 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 text-white transition flex items-center gap-2 text-xs font-bold backdrop-blur-md">
            <i data-lucide="x" class="w-4 h-4"></i> Keluar
        </button>
    </nav>

    <div class="absolute inset-0 flex items-center justify-center z-40 px-4" 
         x-show="!sessionActive"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-90"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-500 transform"
         x-transition:leave-start="opacity-100 scale-100 translate-y-0"
         x-transition:leave-end="opacity-0 scale-110 -translate-y-10">
        
        <div class="glass-panel w-full max-w-[480px] rounded-[2.5rem] p-10 relative overflow-hidden group">
            <div class="mb-8 text-center">
                <h2 class="text-3xl font-extrabold text-white leading-tight mb-2">Siapkan <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent-red to-orange-500">Mental</span></h2>
                <p class="text-sm text-gray-400">Pilih skripsi dan hadapi dosen AI tanpa ampun.</p>
            </div>

            <div class="space-y-6">
                <div x-data="{ open: false, label: '-- Pilih Judul Skripsi --' }" class="relative">
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 block text-center">1. Subjek Penelitian</label>
                    <button @click="open = !open" class="w-full flex items-center justify-between bg-black/40 border border-white/10 rounded-2xl p-4 text-left hover:border-accent-red/50 transition-all group">
                        <div class="flex items-center gap-3 overflow-hidden">
                            <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-gray-400 group-hover:text-white shrink-0"><i data-lucide="file-text" class="w-4 h-4"></i></div>
                            <span class="text-sm font-bold text-white truncate" x-text="label"></span>
                        </div>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-500 transition-transform" :class="open ? 'rotate-180' : ''"></i>
                    </button>
                    <div x-show="open" @click.outside="open = false" x-transition class="absolute top-full left-0 w-full mt-2 bg-[#0F1014] border border-white/10 rounded-2xl shadow-2xl z-50 overflow-hidden max-h-48 overflow-y-auto custom-scroll">
                        <template x-for="p in projects" :key="p.id">
                            <div @click="projectId = p.id; label = p.title; open = false" class="p-3 hover:bg-white/10 cursor-pointer border-b border-white/5 last:border-0 transition-colors">
                                <p class="text-xs font-bold text-white truncate" x-text="p.title"></p>
                            </div>
                        </template>
                        <div x-show="projects.length === 0" class="p-4 text-center text-xs text-gray-500">Belum ada proyek.</div>
                    </div>
                </div>

                <div>
                    <label class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 block text-center">2. Tingkat Kesulitan</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="difficulty = 'normal'" class="p-4 rounded-2xl border flex flex-col items-center gap-2 transition-all group" :class="difficulty === 'normal' ? 'bg-blue-500/10 border-blue-500 text-blue-400' : 'bg-black/20 border-white/10 text-gray-500 hover:bg-white/5'">
                            <i data-lucide="shield" class="w-6 h-6 group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs font-bold">Standar</span>
                        </button>
                        <button @click="difficulty = 'hard'" class="p-4 rounded-2xl border flex flex-col items-center gap-2 transition-all relative overflow-hidden group" :class="difficulty === 'hard' ? 'bg-accent-red/10 border-accent-red text-accent-red shadow-[0_0_20px_rgba(255,42,42,0.2)]' : 'bg-black/20 border-white/10 text-gray-500 hover:bg-white/5'">
                            <div class="absolute inset-0 bg-accent-red/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <i data-lucide="skull" class="w-6 h-6 group-hover:animate-pulse"></i>
                            <span class="text-xs font-bold">Killer</span>
                        </button>
                    </div>
                </div>
            </div>

            <button @click="startSession()" :disabled="!projectId || isLoading" 
                    class="mt-8 w-full py-5 rounded-2xl bg-white text-black font-extrabold text-sm uppercase tracking-wider hover:bg-accent-red hover:text-white hover:shadow-[0_0_40px_rgba(255,42,42,0.5)] transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                <span x-show="!isLoading">MULAI SIDANG</span>
                <span x-show="isLoading" class="flex items-center gap-2"><i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> MEMUAT...</span>
            </button>
        </div>
    </div>

    <div class="fixed inset-0 z-30 flex flex-col transition-all duration-700 delay-200"
         x-show="sessionActive"
         x-transition:enter="opacity-0 scale-95 blur-sm"
         x-transition:enter-end="opacity-100 scale-100 blur-0"
         x-cloak>
        
        <div class="absolute top-0 left-0 w-full p-8 flex flex-col items-center z-40 bg-gradient-to-b from-bg-main via-bg-main/80 to-transparent pointer-events-none">
            
            <div class="relative mb-3 pointer-events-auto hover:scale-110 transition-transform duration-300 cursor-help" title="Status Dosen">
                
                <div class="avatar good" x-show="['neutral', 'impressed'].includes(currentMood)" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-50" x-transition:enter-end="opacity-100 scale-100">
                    <div class="face">
                        <div class="eyes">
                            <span class="eye left"></span><span class="eye right"></span>
                        </div>
                        <div class="mouth smile"></div>
                    </div>
                </div>

                <div class="avatar killer" x-show="['angry', 'annoyed'].includes(currentMood)" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-50" x-transition:enter-end="opacity-100 scale-100">
                    <div class="face">
                        <div class="eyes">
                            <span class="eye left"></span><span class="eye right"></span>
                        </div>
                        <div class="mouth"></div>
                    </div>
                </div>

            </div>
            
            <div class="bg-black/30 backdrop-blur px-5 py-2 rounded-full border border-white/5 shadow-xl pointer-events-auto">
                <p class="text-[10px] font-mono uppercase tracking-widest transition-colors duration-300 font-bold"
                   :class="currentMood === 'angry' ? 'text-accent-red' : (currentMood === 'annoyed' ? 'text-yellow-500' : 'text-green-400')" 
                   x-text="getMoodText(currentMood)"></p>
            </div>
        </div>

        <div id="chat-container" class="flex-1 overflow-y-auto custom-scroll pt-64 pb-40 px-4 md:px-20 lg:px-40 scroll-smooth">
            <div class="flex flex-col gap-6 max-w-4xl mx-auto">
                <template x-for="(msg, idx) in chatHistory" :key="idx">
                    <div class="w-full flex" :class="msg.sender === 'ai' ? 'justify-start' : 'justify-end'">
                        <div class="bubble animate-fade-in-up transform transition-all hover:scale-[1.01]" :class="msg.sender === 'ai' ? 'chat-ai' : 'chat-user'">
                            <p class="text-base" x-html="formatText(msg.text)"></p>
                            <span class="absolute -bottom-6 text-[9px] font-bold text-gray-500 uppercase tracking-widest opacity-50"
                                  :class="msg.sender === 'ai' ? 'left-4' : 'right-4'"
                                  x-text="msg.sender === 'ai' ? 'Dosen Penguji' : 'Anda'"></span>
                        </div>
                    </div>
                </template>
                
                <div x-show="isThinking" class="flex justify-start">
                    <div class="bg-white/5 rounded-full px-5 py-3 flex gap-2">
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-3xl z-40">
            <div class="glass-panel rounded-[2.5rem] p-3 flex items-end gap-3 shadow-2xl transition-all focus-within:border-accent-red/50">
                <textarea x-model="userInput" @keydown.enter.prevent="sendReply()" 
                          placeholder="Jawab pertanyaan dosen di sini (Enter untuk kirim)..." 
                          class="w-full bg-transparent text-white text-base font-medium px-6 py-4 outline-none resize-none h-16 max-h-32 custom-scroll placeholder-gray-600 focus:h-24 transition-all duration-300"></textarea>
                
                <div class="flex flex-col gap-2 pb-2 pr-2">
                    <button @click="sendReply()" :disabled="!userInput.trim() || isThinking" 
                            class="w-12 h-12 rounded-full bg-white text-black flex items-center justify-center hover:bg-accent-red hover:text-white transition-all shadow-lg transform active:scale-90 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i data-lucide="send" class="w-5 h-5 ml-0.5"></i>
                    </button>
                </div>
            </div>
            <div class="text-center mt-4">
                <button @click="endSession()" class="text-[10px] font-bold text-gray-500 hover:text-accent-red transition uppercase tracking-widest flex items-center justify-center gap-2 mx-auto px-4 py-2 rounded-full hover:bg-white/5 border border-transparent hover:border-white/10">
                    <i data-lucide="flag" class="w-3 h-3"></i> Menyerah & Keluar
                </button>
            </div>
        </div>
    </div>

    <div x-show="showReport" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-xl flex items-center justify-center p-4 transition-all duration-500" 
         x-transition:enter="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-cloak>
        <div class="w-full max-w-5xl glass-panel rounded-[3rem] p-12 relative overflow-hidden flex flex-col md:flex-row gap-12 max-h-[90vh] custom-scroll border border-white/20">
            <button @click="resetState()" class="absolute top-8 right-8 p-3 bg-white/5 hover:bg-white/10 rounded-full text-gray-400 hover:text-white transition"><i data-lucide="x" class="w-6 h-6"></i></button>
            
            <div class="md:w-1/3 flex flex-col items-center justify-center text-center border-b md:border-b-0 md:border-r border-white/10 pb-8 md:pb-0 md:pr-12">
                <span class="text-7xl font-black text-white mb-2 tracking-tighter" x-text="report.score"></span>
                <span class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-6">Skor Akhir</span>
                <div class="px-8 py-3 rounded-full border border-white/10 bg-white/5 text-sm font-bold shadow-lg" :class="report.score >= 60 ? 'text-green-400 border-green-500/30' : 'text-red-400 border-red-500/30'" x-text="report.verdict"></div>
            </div>

            <div class="md:w-2/3 space-y-8 overflow-y-auto pr-2 custom-scroll">
                <div>
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-4">Analisis Performa</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-green-500/5 border border-green-500/20 p-6 rounded-3xl">
                            <span class="text-xs font-bold text-green-400 uppercase mb-3 block flex items-center gap-2"><i data-lucide="thumbs-up" class="w-4 h-4"></i> Kekuatan</span>
                            <ul class="space-y-2"><template x-for="s in report.strengths"><li class="text-sm text-gray-300 flex gap-2"><span class="text-green-500">•</span><span x-text="s"></span></li></template></ul>
                        </div>
                        <div class="bg-red-500/5 border border-red-500/20 p-6 rounded-3xl">
                            <span class="text-xs font-bold text-red-400 uppercase mb-3 block flex items-center gap-2"><i data-lucide="alert-octagon" class="w-4 h-4"></i> Kelemahan</span>
                            <ul class="space-y-2"><template x-for="w in report.weaknesses"><li class="text-sm text-gray-300 flex gap-2"><span class="text-red-500">•</span><span x-text="w"></span></li></template></ul>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-500/5 border border-blue-500/10 p-6 rounded-3xl">
                    <h4 class="text-xs font-bold text-blue-400 uppercase mb-3 flex items-center gap-2"><i data-lucide="lightbulb" class="w-4 h-4"></i> Saran Strategis</h4>
                    <p class="text-sm text-gray-300 leading-relaxed font-medium" x-text="report.advice"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function defenseApp() {
            return {
                projects: [], projectId: '', difficulty: 'hard', sessionActive: false, isLoading: false, isThinking: false, chatHistory: [], currentMood: 'neutral', userInput: '', showReport: false, report: { score: 0, verdict: '-', strengths: [], weaknesses: [], advice: '-' },
                
                async init() {
                    try { const res = await fetch('/api/get-user-projects'); if(res.ok) this.projects = await res.json(); } catch(e) {}
                    this.$nextTick(() => lucide.createIcons());
                },
                
                showToast(message, type = 'info') {
                    const container = document.getElementById('toast-container');
                    const toast = document.createElement('div');
                    const types = { 'error': 'toast-error', 'success': 'toast-success', 'info': 'toast-info' };
                    const icons = { 'error': 'alert-circle', 'success': 'check-circle', 'info': 'info' };
                    
                    toast.className = `toast ${types[type] || 'toast-info'}`;
                    toast.innerHTML = `<i data-lucide="${icons[type] || 'info'}" class="w-5 h-5"></i> <span>${message}</span>`;
                    container.appendChild(toast);
                    lucide.createIcons();
                    
                    requestAnimationFrame(() => toast.classList.add('show'));
                    setTimeout(() => { 
                        toast.classList.remove('show'); 
                        setTimeout(() => toast.remove(), 500); 
                    }, 4000);
                },

                async startSession() {
                    if(!this.projectId) return this.showToast("Pilih proyek skripsi dulu!", 'error');
                    this.isLoading = true; this.chatHistory = [];
                    try {
                        const res = await fetch('/api/defense/start', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ projectId: this.projectId, difficulty: this.difficulty }) });
                        const data = await res.json();
                        if(data.status === 'success') { 
                            this.sessionActive = true; 
                            this.handleAIResponse(data.response); 
                            this.showToast("Sidang Dimulai. Good luck!", 'info');
                        } else { 
                            this.showToast("Gagal: " + data.error, 'error'); 
                        }
                    } catch(e) { this.showToast("Error koneksi server.", 'error'); } finally { this.isLoading = false; }
                },
                async sendReply() {
                    if(!this.userInput.trim()) return;
                    this.chatHistory.push({ sender: 'user', text: this.userInput });
                    this.userInput = ''; this.scrollToBottom(); this.isThinking = true;
                    try {
                        const res = await fetch('/api/defense/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ history: this.chatHistory, projectId: this.projectId }) });
                        const data = await res.json();
                        if(data.status === 'success') { this.handleAIResponse(data.response); }
                    } catch(e) { 
                        this.chatHistory.push({ sender: 'ai', text: "Sistem gangguan..." }); 
                        this.showToast("Koneksi terputus.", 'error');
                    } finally { this.isThinking = false; this.scrollToBottom(); }
                },
                handleAIResponse(aiData) {
                    this.currentMood = aiData.current_mood || 'neutral';
                    this.chatHistory.push({ sender: 'ai', text: aiData.examiner_response });
                    this.scrollToBottom();
                    this.$nextTick(() => lucide.createIcons());
                },
                async endSession() {
                    if(!confirm("Yakin ingin menyerah?")) return;
                    this.isThinking = true;
                    try {
                        const res = await fetch('/api/defense/evaluate', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ history: this.chatHistory }) });
                        const data = await res.json();
                        if(data.status === 'success') { this.report = data.report; this.showReport = true; }
                    } catch(e) { this.showToast("Gagal evaluasi.", 'error'); } finally { this.isThinking = false; }
                },
                resetState() { this.sessionActive = false; this.chatHistory = []; this.currentMood = 'neutral'; this.showReport = false; },
                getMoodText(mood) { const map = { 'neutral': 'Mengamati', 'annoyed': 'Terganggu', 'angry': 'MURKA!', 'impressed': 'Terkesan' }; return map[mood] || '...'; },
                formatText(text) { return text.replace(/\n/g, '<br>'); },
                scrollToBottom() { this.$nextTick(() => { const container = document.getElementById('chat-container'); container.scrollTop = container.scrollHeight + 500; }); }
            }
        }
    </script>
</body>
</html>